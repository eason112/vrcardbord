<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
        <a-assets>
          <img id="skyTexture"
            src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg">
        <img id="imageTexture" src="https://eason112.github.io/vrcardbord/asset/image.png">
        <video id="video1" src="https://eason112.github.io/vrcardbord/asset/video.mp4" loop="true"></video>
        <video id="video2" src="https://eason112.github.io/vrcardbord/asset/video.mp4" loop="true"></video>
        </a-assets>
      
      
        <a-sky src="#skyTexture"></a-sky>
        <a-plane class="clickable imagePlane"  position="4 1 -3" rotation="0 -45 0" width="3" height="2" src="#imageTexture" data-video-index="0" data-video-src="#video1"></a-plane>
        <a-plane class="clickable imagePlane"  position="-4 1 -3" rotation="0 45 0" width="3" height="2" src="#imageTexture" data-video-index="1" data-video-src="#video2"></a-plane>
    
          <!-- 影片播放器 -->
        <a-video id='videoplayer' src="" position="4 1 -3" rotation="0 -45 0" width="3" height="2" visible="false">
          <a-image class="clickable" id="videoControls" src="#imageTexture" position="0 -1.5 0" scale="0.5 0.5 1"></a-image>
        </a-video>

          
        <a-camera>
            <a-entity
            raycaster="objects:.clickable"
            id="cursor"
            cursor="fuse: true; fuseTimeout:3000"
            animation__fusing="property: scale; startEvents: fusing; dur: 3000; from: 1 1 1; to: 0.1 0.1 0.1"
            animation__reset="property: scale; startEvents: mouseleave; dur: 1000; to: 1 1 1"
            material="color: black; shader: flat"
            position="0 0 -3"
            geometry="primitive: ring; radius-inner:0.02; radius-outer:0.04;"></a-entity>
        </a-camera>
      </a-scene>
  </body>
  <script>
    const video1 = document.querySelector('#video1');
    const video2 = document.querySelector('#video2');
    const videos = [video1, video2]; // 影片
    let currentvideo;

    let isLookingAtImage = false;
    let isOpenVideo = true;
    let timer;
    let leavetimer;
    let pausetimer;
    
    let currentindex;

    let images= document.querySelectorAll('.imagePlane');
    let videoplayer = document.querySelector('#videoplayer');
    let toggleplay=document.querySelector('#videoControls');
    const cursor = document.querySelector('#cursor');  // 光标元素

    // 當光標進入圖片區域時
    images.forEach(function(imagePlane, index) {
      imagePlane.addEventListener('mouseenter', function() {
        isLookingAtImage = true;
        // 設置光标顏色變為白色
        cursor.setAttribute('material', 'color: white');
        if(currentindex==index)
        clearTimeout(leavetimer);  // 取消定時器
        // 設置定時器
        timer = setTimeout(() => {
          if (isLookingAtImage) {
            // 顯示影片
            if(isOpenVideo){
              isOpenVideo=false;
              currentindex=index;
              const videoIndex = imagePlane.getAttribute('data-video-index');
              const videoSrc = imagePlane.getAttribute('data-video-src');
              const position = imagePlane.getAttribute('position');
              const rotation = imagePlane.getAttribute('rotation');

              videoplayer.setAttribute('position', position);
              videoplayer.setAttribute('rotation', rotation);
              videoplayer.setAttribute('src', videoSrc);
              videoplayer.setAttribute('visible', 'true');

              currentvideo=videos[videoIndex];
              currentvideo.currentTime=0; 
              currentvideo.play();
            }
          }
        }, 3000);  // 3秒後播放影片
      });

      // 當光標離開圖片區域時
      imagePlane.addEventListener('mouseleave', function() {
        isLookingAtImage = false;
        
        clearTimeout(timer);  // 取消定時器
        if(currentindex==index){
          leavetimer = setTimeout(() => {
              // 顯示影片
              console.log(currentindex,index);
              
              videoplayer.setAttribute('visible', 'false');
              isOpenVideo=true;
              currentvideo.pause();
              
                
          }, 3000);  // 3秒後播放影片
          // 恢復光标狀態
        }
        cursor.setAttribute('material', 'color: black');
      });
    });
    toggleplay.addEventListener('mouseenter', function() {
        // 設置光标顏色變為白色
        cursor.setAttribute('material', 'color: white');
        clearTimeout(leavetimer);  // 取消定時器
        // 設置定時器
        pausetimer = setTimeout(() => {
            // 顯示影片
            if(currentvideo.paused){
              currentvideo.play();
              }
              else{
                currentvideo.pause();
              }
        }, 3000);  // 3秒後播放影片
      });
      toggleplay.addEventListener('mouseleave', function() {
        clearTimeout(pausetimer);  // 取消定時器
        // 恢復光标狀態
        leavetimer = setTimeout(() => {
              // 顯示影片
              
              videoplayer.setAttribute('visible', 'false');
              isOpenVideo=true;
              currentvideo.pause();
              
                
          }, 3000);  // 3秒後播放影片
        cursor.setAttribute('material', 'color: black');
      });
  </script>
</html>